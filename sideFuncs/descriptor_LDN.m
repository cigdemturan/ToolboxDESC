function [C] = descriptor_LDN(I,varargin)
% Computes LDN response, according to eight masks and returns the top
% directions
% Direction for each pixel:
% - pos (first) edge direction
% - neg (second) gradient direction
%
% If you use this code, cite
% Ramirez Rivera, A.; Rojas Castillo; Oksam Chae, "Local Directional Number
% Pattern for Face Analysis: Face and Expression Recognition," Image Processing,
% IEEE Transactions on , vol.22, no.5, pp.1740,1752, May 2013 doi: 10.1109/TIP.2012.2235848
%
% BibTeX:
% @ARTICLE{Ramirez2013,
%   author={Ram\'irez Rivera, A. and Rojas Castillo and Oksam Chae},
%   journal={Image Processing, IEEE Transactions on},
%   title={Local Directional Number Pattern for Face Analysis: Face and Expression Recognition},
%   year={2013},
%   month={May},
%   volume={22},
%   number={5},
%   pages={1740--1752},
%   doi={10.1109/TIP.2012.2235848},
%   ISSN={1057-7149},
% }


%% Default values
msize = 3;
mask = 'kirsch';
sigma = 0.5; 

%% Convert the image to gray scale
if (size(I,3) ~= 1), I = rgb2gray(I); end;
I = double(I);

%% Parameters
optargin = size(varargin, 2);
stdargin = nargin - optargin;

if stdargin < 1
  error('at least 1 arguments required');
end
% parse options
i = 1;
while (i <= optargin)
  if (strcmp(varargin{i}, 'masksize'))
    if (i >= optargin)
      error('argument required for %s', varargin{i});
    else
      msize = varargin{i+1};
      i = i + 2;
    end
  elseif (strcmp(varargin{i}, 'mask'))
    if (i >= optargin)
      error('argument required for %s', varargin{i});
    else
      mask = varargin{i+1};
      i = i + 2;
    end
  elseif (strcmp(varargin{i}, 'sigma'))
    if (i >= optargin)
      error('argument required for %s', varargin{i});
    else
      sigma = varargin{i+1};
      i = i + 2;
    end  
  else
    error('argument %s is does not exist',varargin{i});
  end
end

%% Masks
switch lower(mask)
  case 'gaussian'
    % see the paper for the values of sigma, and how it changes the size of
    % the Gaussian mask
    D = gaussGradient(sigma);
  case 'kirsch'
    switch msize
      case 3
        D(:,:,1) = [-3 -3  5; -3  0  5; -3 -3  5];      %East
        D(:,:,2) = [-3  5, 5; -3  0  5; -3 -3 -3];      %North East
        D(:,:,3) = [ 5  5  5; -3  0 -3; -3 -3 -3];      %North
        D(:,:,4) = [ 5  5 -3;  5  0 -3; -3 -3 -3];      %North West
        D(:,:,5) = [ 5 -3 -3;  5  0 -3;  5 -3 -3];      %West
        D(:,:,6) = [-3 -3 -3;  5  0 -3;  5  5 -3];      %South West
        D(:,:,7) = [-3 -3 -3; -3  0 -3;  5  5  5];      %South
        D(:,:,8) = [-3 -3 -3; -3  0  5; -3  5  5];      %South Eest
      case 5
        D(:,:,1) = [-5 -5 -5 -5 11; -5 -3 -3 5 11; -5 -3 0 5 11; -5 -3 -3 5 11; -5 -5 -5 -5 11];      %East
        D(:,:,2) = [-5 -5 11 11 11; -5 -3 5 5 11; -5 -3 0 5 11; -5 -3 -3 -3 -5; -5 -5 -5 -5 -5];      %North East
        D(:,:,3) = [ 11 11 11 11 11; -5 5 5 5 -5; -5 -3 0 -3 -5; -5 -3 -3 -3 -5; -5 -5 -5 -5 -5];     %North
        D(:,:,4) = [ 11 11 11 -5 -5; 11 5 5 -3 -5; 11 5 0 -3 -5; -5 -3 -3 -3 -5; -5 -5 -5 -5 -5];     %North West
        D(:,:,5) = [ 11 -5 -5 -5 -5; 11 5 -3 -3 -5; 11 5 0 -3 -5; 11 5 -3 -3 -5; 11 -5 -5 -5 -5];     %West
        D(:,:,6) = [-5 -5 -5 -5 -5; -5 -3 -3 -3 -5; 11 5 0 -3 -5; 11 5 5 -3 -5; 11 11 11 -5 -5];      %South West
        D(:,:,7) = [-5 -5 -5 -5 -5; -5 -3 -3 -3 -5; -5 -3 0 -3 -5; -5 5 5 5 -5; 11 11 11 11 11];      %South
        D(:,:,8) = [-5 -5 -5 -5 -5; -5 -3 -3 -3 -5; -5 -3 0 5 11; -5 -3 5 5 11; -5 -5 11 11 11];      %South West
      case 7
        D(:,:,1) = [-7 -7 -7 -7 -7 -7 17;-7 -5 -5 -5 -5 11 17;-7 -5 -3 -3 5 11 17;-7 -5 -3 0 5 11 17; -7 -5 -3 -3 5 11 17;-7 -5 -5 -5 -5 11 17;-7 -7 -7 -7 -7 -7 17];     %East
        D(:,:,2) = [-7 -7 -7 17 17 17 17;-7 -5 -5 11 11 11 17;-7 -5 -3 5 5 11 17;-7 -5 -3 0 5 11 17; -7 -5 -3 -3 -3 -5 -7;-7 -5 -5 -5 -5 -5 -7;-7 -7 -7 -7 -7 -7 -7];     %North East
        D(:,:,3) = [17 17 17 17 17 17 17;-7 11 11 11 11 11 -7;-7 -5 5 5 5 -5 -7;-7 -5 -3 0 -3 -5 -7;-7 -5 -3 -3 -3 -5 -7;-7 -5 -5 -5 -5 -5 -7;-7 -7 -7 -7 -7 -7 -7];      %North
        D(:,:,4) = [17 17 17 17 -7 -7 -7;17 11 11 11 -5 -5 -7;17 11 5 5 -3 -5 -7;17 11 5 0 -3 -5 -7;-7 -5 -3 -3 -3 -5 -7;-7 -5 -5 -5 -5 -5 -7;-7 -7 -7 -7 -7 -7 -7];      %North West
        D(:,:,5) = [17 -7 -7 -7 -7 -7 -7;17 11 -5 -5 -5 -5 -7;17 11 5 -3 -3 -5 -7;17 11 5 0 -3 -5 -7;17 11 5 -3 -3 -5 -7;17 11 -5 -5 -5 -5 -7;17 -7 -7 -7 -7 -7 -7];      %West
        D(:,:,6) = [-7 -7 -7 -7 -7 -7 -7;-7 -5 -5 -5 -5 -5 -7;-7 -5 -3 -3 -3 -5 -7;17 11 5 0 -3 -5 -7;17 11 5 5 -3 -5 -7;17 11 11 11 -5 -5 -7;17 17 17 17 -7 -7 -7];      %South West
        D(:,:,7) = [-7 -7 -7 -7 -7 -7 -7;-7 -5 -5 -5 -5 -5 -7;-7 -5 -3 -3 -3 -5 -7;-7 -5 -3 0 -3 -5 -7;-7 -5 5 5 5 -5 -7;-7 11 11 11 11 11 -7;17 17 17 17 17 17 17];      %South
        D(:,:,8) = [-7 -7 -7 -7 -7 -7 -7;-7 -5 -5 -5 -5 -5 -7;-7 -5 -3 -3 -3 -5 -7;-7 -5 -3 0 5 11 17; -7 -5 -3 5 5 11 17;-7 -5 -5 11 11 11 17;-7 -7 -7 17 17 17 17];     %South West
      case 9
        D(:,:,1) = [-9 -9 -9 -9 -9 -9 -9 -9 23;-9 -7 -7 -7 -7 -7 -7 17 23;-9 -7 -5 -5 -5 -5 11 17 23;-9 -7 -5 -3 -3 5 11 17 23;-9 -7 -5 -3 0 5 11 17 23;-9 -7 -5 -3 -3 5 11 17 23;-9 -7 -5 -5 -5 -5 11 17 23;-9 -7 -7 -7 -7 -7 -7 17 23;-9 -9 -9 -9 -9 -9 -9 -9 23];      %East
        D(:,:,2) = [-9 -9 -9 -9 23 23 23 23 23;-9 -7 -7 -7 17 17 17 17 23;-9 -7 -5 -5 11 11 11 17 23;-9 -7 -5 -3 5 5 11 17 23;-9 -7 -5 -3 0 5 11 17 23;-9 -7 -5 -3 -3 -3 -5 -7 -9;-9 -7 -5 -5 -5 -5 -5 -7 -9;-9 -7 -7 -7 -7 -7 -7 -7 -9;-9 -9 -9 -9 -9 -9 -9 -9 -9];      %North East
        D(:,:,3) = [23 23 23 23 23 23 23 23 23;-9 17 17 17 17 17 17 17 -9;-9 -7 11 11 11 11 11 -7 -9;-9 -7 -5 5 5 5 -5 -7 -9;-9 -7 -5 -3 0 -3 -5 -7 -9;-9 -7 -5 -3 -3 -3 -5 -7 -9;-9 -7 -5 -5 -5 -5 -5 -7 -9;-9 -7 -7 -7 -7 -7 -7 -7 -9;-9 -9 -9 -9 -9 -9 -9 -9 -9];      %North
        D(:,:,4) = [23 23 23 23 23 -9 -9 -9 -9;23 17 17 17 17 -7 -7 -7 -9;23 17 11 11 11 -5 -5 -7 -9;23 17 11 5 5 -3 -5 -7 -9;23 17 11 5 0 -3 -5 -7 -9;-9 -7 -5 -3 -3 -3 -5 -7 -9;-9 -7 -5 -5 -5 -5 -5 -7 -9;-9 -7 -7 -7 -7 -7 -7 -7 -9;-9 -9 -9 -9 -9 -9 -9 -9 -9];      %North West
        D(:,:,5) = [23 -9 -9 -9 -9 -9 -9 -9 -9;23 17 -7 -7 -7 -7 -7 -7 -9;23 17 11 -5 -5 -5 -5 -7 -9;23 17 11 5 -3 -3 -5 -7 -9;23 17 11 5 0 -3 -5 -7 -9;23 17 11 5 -3 -3 -5 -7 -9;23 17 11 -5 -5 -5 -5 -7 -9;23 17 -7 -7 -7 -7 -7 -7 -9;23 -9 -9 -9 -9 -9 -9 -9 -9];      %West
        D(:,:,6) = [-9 -9 -9 -9 -9 -9 -9 -9 -9;-9 -7 -7 -7 -7 -7 -7 -7 -9;-9 -7 -5 -5 -5 -5 -5 -7 -9;-9 -7 -5 -3 -3 -3 -5 -7 -9;23 17 11 5 0 -3 -5 -7 -9;23 17 11 5 5 -3 -5 -7 -9;23 17 11 11 11 -5 -5 -7 -9;23 17 17 17 17 -7 -7 -7 -9;23 23 23 23 23 -9 -9 -9 -9];      %South West
        D(:,:,7) = [-9 -9 -9 -9 -9 -9 -9 -9 -9;-9 -7 -7 -7 -7 -7 -7 -7 -9;-9 -7 -5 -5 -5 -5 -5 -7 -9;-9 -7 -5 -3 -3 -3 -5 -7 -9;-9 -7 -5 -3 0 -3 -5 -7 -9;-9 -7 -5 5 5 5 -5 -7 -9;-9 -7 11 11 11 11 11 -7 -9;-9 17 17 17 17 17 17 17 -9;23 23 23 23 23 23 23 23 23];      %South
        D(:,:,8) = [-9 -9 -9 -9 -9 -9 -9 -9 -9;-9 -7 -7 -7 -7 -7 -7 -7 -9;-9 -7 -5 -5 -5 -5 -5 -7 -9;-9 -7 -5 -3 -3 -3 -5 -7 -9;-9 -7 -5 -3 0 5 11 17 23;-9 -7 -5 -3 5 5 11 17 23; -9 -7 -5 -5 11 11 11 17 23;-9 -7 -7 -7 17 17 17 17 23;-9 -9 -9 -9 23 23 23 23 23];     %South West
      case 11
        D(:,:,1) = [-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 29;-11 -9 -9 -9 -9 -9 -9 -9 -9 23 29;-11 -9 -7 -7 -7 -7 -7 -7 17 23 29;-11 -9 -7 -5 -5 -5 -5 11 17 23 29;-11 -9 -7  -5 -3 -3 5 11 17 23 29;-11 -9 -7 -5 -3 0 5 11 17 23 29;-11 -9 -7 -5 -3 -3 5 11 17 23 29;-11 -9 -7 -5 -5 -5 -5 11 17 23 29;-11 -9 -7 -7 -7 -7 -7 -7 17 23 29;-11 -9 -9 -9 -9 -9 -9 -9 -9 23 29;-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 29];     %East
        D(:,:,2) = [-11 -11 -11 -11 -11 29 29 29 29 29 29;-11 -9 -9 -9 -9 23 23 23 23 23 29;-11 -9 -7 -7 -7 17 17 17 17 23 29;-11 -9 -7 -5 -5 11 11 11 17 23 29;-11 -9 -7 -5 -3 5 5 11 17 23 29;-11 -9 -7 -5 -3 0 5 11 17 23 29;-11 -9 -7 -5 -3 -3 -3 -5 -7 -9 -11;-11 -9 -7 -5 -5 -5 -5 -5 -7 -9 -11;-11 -9 -7 -7 -7 -7 -7 -7 -7 -9 -11;-11 -9 -9 -9 -9 -9 -9 -9 -9 -9 -11;-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11];      %North East
        D(:,:,3) = [29 29 29 29 29 29 29 29 29 29 29;-11 23 23 23 23 23 23 23 23 23 -11;-11 -9 17 17 17 17 17 17 17 -9 -11;-11 -9 -7 11 11 11 11 11 -7 -9 -11;-11 -9 -7 -5 5 5 5 -5 -7 -9 -11;-11 -9 -7 -5 -3 0 -3 -5 -7 -9 -11;-11 -9 -7 -5 -3 -3 -3 -5 -7 -9 -11;-11 -9 -7 -5 -5 -5 -5 -5 -7 -9 -11;-11 -9 -7 -7 -7 -7 -7 -7 -7 -9 -11;-11 -9 -9 -9 -9 -9 -9 -9 -9 -9 -11;-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11];      %North
        D(:,:,4) = [29 29 29 29 29 29 -11 -11 -11 -11 -11;29 23 23 23 23 23 -9 -9 -9 -9 -11;29 23 17 17 17 17 -7 -7 -7 -9 -11;29 23 17 11 11 11 -5 -5 -7 -9 -11;29 23 17 11 5 5 -3 -5 -7 -9 -11;29 23 17 11 5 0 -3 -5 -7 -9 -11;-11 -9 -7 -5 -3 -3 -3 -5 -7 -9 -11;-11 -9 -7 -5 -5 -5 -5 -5 -7 -9 -11;-11 -9 -7 -7 -7 -7 -7 -7 -7 -9 -11;-11 -9 -9 -9 -9 -9 -9 -9 -9 -9 -11;-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11];      %North West
        D(:,:,5) = [29 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11;29 23 -9 -9 -9 -9 -9 -9 -9 -9 -11;29 23 17 -7 -7 -7 -7 -7 -7 -9 -11;29 23 17 11 -5 -5 -5 -5 -7 -9 -11;29 23 17 11 5 -3 -3 -5 -7 -9 -11;29 23 17 11 5 0 -3 -5 -7 -9 -11;29 23 17 11 5 -3 -3 -5 -7 -9 -11;29 23 17 11 -5 -5 -5 -5 -7 -9 -11;29 23 17 -7 -7 -7 -7 -7 -7 -9 -11;29 23 -9 -9 -9 -9 -9 -9 -9 -9 -11;29 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11];      %West
        D(:,:,6) = [-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11;-11 -9 -9 -9 -9 -9 -9 -9 -9 -9 -11;-11 -9 -7 -7 -7 -7 -7 -7 -7 -9 -11;-11 -9 -7 -5 -5 -5 -5 -5 -7 -9 -11;-11 -9 -7 -5 -3 -3 -3 -5 -7 -9 -11;29 23 17 11 5 0 -3 -5 -7 -9 -11;29 23 17 11 5 5 -3 -5 -7 -9 -11;29 23 17 11 11 11 -5 -5 -7 -9 -11;29 23 17 17 17 17 -7 -7 -7 -9 -11;29 23 23 23 23 23 -9 -9 -9 -9 -11;29 29 29 29 29 29 -11 -11 -11 -11 -11];      %South West
        D(:,:,7) = [-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11;-11 -9 -9 -9 -9 -9 -9 -9 -9 -9 -11;-11 -9 -7 -7 -7 -7 -7 -7 -7 -9 -11;-11 -9 -7 -5 -5 -5 -5 -5 -7 -9 -11;-11 -9 -7 -5 -3 -3 -3 -5 -7 -9 -11;-11 -9 -7 -5 -3 0 -3 -5 -7 -9 -11;-11 -9 -7 -5 5 5 5 -5 -7 -9 -11;-11 -9 -7 11 11 11 11 11 -7 -9 -11;-11 -9 17 17 17 17 17 17 17 -9 -11;-11 23 23 23 23 23 23 23 23 23 -11; 29 29 29 29 29 29 29 29 29 29 29];     %South
        D(:,:,8) = [-11 -11 -11 -11 -11 -11 -11 -11 -11 -11 -11;-11 -9 -9 -9 -9 -9 -9 -9 -9 -9 -11;-11 -9 -7 -7 -7 -7 -7 -7 -7 -9 -11;-11 -9 -7 -5 -5 -5 -5 -5 -7 -9 -11;-11 -9 -7 -5 -3 -3 -3 -5 -7 -9 -11;-11 -9 -7 -5 -3 0 5 11 17 23 29;-11 -9 -7 -5 -3 5 5 11 17 23 29;-11 -9 -7 -5 -5 11 11 11 17 23 29;-11 -9 -7 -7 -7 17 17 17 17 23 29;-11 -9 -9 -9 -9 23 23 23 23 23 29;-11 -11 -11 -11 -11 29 29 29 29 29 29];      %South West
      otherwise
        error('Kirsh mask size not supported. Use only: 3, 5, 7, 9, 11');
    end
  case 'sobel'
    switch msize
      case 3
        D(:,:,1) = [1 2 1; 0 0 0; -1 -2 -1];      %East
        D(:,:,2) = [2 1 0; 1 0 -1; 0 -1 -2];      %North East
        D(:,:,3) = [1 0 -1; 2 0 -2; 1 0 -1];      %North
        D(:,:,4) = [0 -1 -2; 1 0 -1; 2 1 0];      %North West
        D(:,:,5) = [-1 -2 -1; 0 0 0; 1 2 1];      %West
        D(:,:,6) = [-2 -1 0; -1 0 1; 0 1 2];      %South West
        D(:,:,7) = [-1 0 1; -2 0 2; -1 0 1];      %South
        D(:,:,8) = [0 1 2; -1 0 1; -2 -1 0];      %South Eest
      case 5
        D(:,:,1) = [1	2	0	-2	-1;4	8	0	-8	-4;6	12	0	-12	-6;4	8	0	-8	-4;1	2	0	-2	-1];    %East
        D(:,:,2) = [1	4	6	4	1;2	8	12	8	2;0	0	0	0	0;-2	-8	-12	-8	-2;-1	-4	-6	-4	-1];      %North East
        D(:,:,3) = [-1	-4	-6	-4	-1;-2	-8	-12	-8	-2;0	0	0	0	0;2	8	12	8	2;1	4	6	4	1];     %North
        D(:,:,4) = [-1	-2	0	2	1;-4	-8	0	8	4;-6	-12	0	12	6;-4	-8	0	8	4;-1	-2	0	2	1];   %North West
        D(:,:,5) = [0	2	1	4	6;-2	0	8	12	4;-1	-8	0	8	1;-4	-12	-8	0	2;-6	-4	-1	-2	0];   %West
        D(:,:,6) = [6	4	1	2	0;4	12	8	0	-2;1	8	0	-8	-1;2	0	-8	-12	-4;0	-2	-1	-4	-6];    %South West
        D(:,:,7) = [-6	-4	-1	-2	0;-4	-12	-8	0	2;-1	-8	0	8	1;-2	0	8	12	4;0	2	1	4	6];   %South
        D(:,:,8) = [0	-2	-1	-4	-6;2	0	-8	-12	-4;1	8	0	-8	-1;4	12	8	0	-2;6	4	1	2	0];   %South Eest
      case 7
        D(:,:,1) = [1	4	5	0	-5	-4	-1;6	24	30	0	-30	-24	-6;15	60	75	0	-75	-60	-15;20	80	100	0	-100	-80	-20;15	60	75	0	-75	-60	-15;6	24	30	0	-30	-24	-6;1	4	5	0	-5	-4	-1];    %East
        D(:,:,2) = [1	6	15	20	15	6	1;4	24	60	80	60	24	4;5	30	75	100	75	30	5;0	0	0	0	0	0	0;-5	-30	-75	-100	-75	-30	-5;-4	-24	-60	-80	-60	-24	-4;-1	-6	-15	-20	-15	-6	-1];      %North East
        D(:,:,3) = [-1	-6	-15	-20	-15	-6	-1;-4	-24	-60	-80	-60	-24	-4;-5	-30	-75	-100	-75	-30	-5;0	0	0	0	0	0	0;5	30	75	100	75	30	5;4	24	60	80	60	24	4;1	6	15	20	15	6	1];     %North
        D(:,:,4) = [-1	-4	-5	0	5	4	1;-6	-24	-30	0	30	24	6;-15	-60	-75	0	75	60	15;-20	-80	-100	0	100	80	20;-15	-60	-75	0	75	60	15;-6	-24	-30	0	30	24	6;-1	-4	-5	0	5	4	1];   %North West
        D(:,:,5) = [0	5	4	1	6	15	20;-5	0	30	24	60	80	15;-4	-30	0	75	100	60	6;-1	-24	-75	0	75	24	1;-6	-60	-100	-75	0	30	4;-15	-80	-60	-24	-30	0	5;-20	-15	-6	-1	-4	-5	0];     %West
        D(:,:,6) = [20	15	6	1	4	5	0;15	80	60	24	30	0	-5;6	60	100	75	0	-30	-4;1	24	75	0	-75	-24	-1;4	30	0	-75	-100	-60	-6;5	0	-30	-24	-60	-80	-15;0	-5	-4	-1	-6	-15	-20]; %South West
        D(:,:,7) = [-20	-15	-6	-1	-4	-5	0;-15	-80	-60	-24	-30	0	5;-6	-60	-100	-75	0	30	4;-1	-24	-75	0	75	24	1;-4	-30	0	75	100	60	6;-5	0	30	24	60	80	15;0	5	4	1	6	15	20];  %South
        D(:,:,8) = [0	-5	-4	-1	-6	-15	-20;5	0	-30	-24	-60	-80	-15;4	30	0	-75	-100	-60	-6;1	24	75	0	-75	-24	-1;6	60	100	75	0	-30	-4;15	80	60	24	30	0	-5;20	15	6	1	4	5	0];     %South Eest
      case 9
        D(:,:,1) = [1	6	14	14	0	-14	-14	-6	-1;8	48	112	112	0	-112	-112	-48	-8;28	168	392	392	0	-392	-392	-168	-28;56	336	784	784	0	-784	-784	-336	-56;70	420	980	980	0	-980	-980	-420	-70;56	336	784	784	0	-784	-784	-336	-56;28	168	392	392	0	-392	-392	-168	-28;8	48	112	112	0	-112	-112	-48	-8;1	6	14	14	0	-14	-14	-6	-1];    %East
        D(:,:,2) = [1	8	28	56	70	56	28	8	1;6	48	168	336	420	336	168	48	6;14	112	392	784	980	784	392	112	14;14	112	392	784	980	784	392	112	14;0	0	0	0	0	0	0	0	0;-14	-112	-392	-784	-980	-784	-392	-112	-14;-14	-112	-392	-784	-980	-784	-392	-112	-14;-6	-48	-168	-336	-420	-336	-168	-48	-6;-1	-8	-28	-56	-70	-56	-28	-8	-1];      %North East
        D(:,:,3) = [-1	-8	-28	-56	-70	-56	-28	-8	-1;-6	-48	-168	-336	-420	-336	-168	-48	-6;-14	-112	-392	-784	-980	-784	-392	-112	-14;-14	-112	-392	-784	-980	-784	-392	-112	-14;0	0	0	0	0	0	0	0	0;14	112	392	784	980	784	392	112	14;14	112	392	784	980	784	392	112	14;6	48	168	336	420	336	168	48	6;1	8	28	56	70	56	28	8	1];     %North
        D(:,:,4) = [-1	-6	-14	-14	0	14	14	6	1;-8	-48	-112	-112	0	112	112	48	8;-28	-168	-392	-392	0	392	392	168	28;-56	-336	-784	-784	0	784	784	336	56;-70	-420	-980	-980	0	980	980	420	70;-56	-336	-784	-784	0	784	784	336	56;-28	-168	-392	-392	0	392	392	168	28;-8	-48	-112	-112	0	112	112	48	8;-1	-6	-14	-14	0	14	14	6	1];   %North West
        D(:,:,5) = [0	14	14	6	1	8	28	56	70;-14	0	112	112	48	168	336	420	56;-14	-112	0	392	392	784	980	336	28;-6	-112	-392	0	784	980	784	168	8;-1	-48	-392	-784	0	784	392	48	1;-8	-168	-784	-980	-784	0	392	112	6;-28	-336	-980	-784	-392	-392	0	112	14;-56	-420	-336	-168	-48	-112	-112	0	14;-70	-56	-28	-8	-1	-6	-14	-14	0];   %West
        D(:,:,6) = [70	56	28	8	1	6	14	14	0;56	420	336	168	48	112	112	0	-14;28	336	980	784	392	392	0	-112	-14;8	168	784	980	784	0	-392	-112	-6;1	48	392	784	0	-784	-392	-48	-1;6	112	392	0	-784	-980	-784	-168	-8;14	112	0	-392	-392	-784	-980	-336	-28;14	0	-112	-112	-48	-168	-336	-420	-56;0	-14	-14	-6	-1	-8	-28	-56	-70];   %South West
        D(:,:,7) = [-70	-56	-28	-8	-1	-6	-14	-14	0;-56	-420	-336	-168	-48	-112	-112	0	14;-28	-336	-980	-784	-392	-392	0	112	14;-8	-168	-784	-980	-784	0	392	112	6;-1	-48	-392	-784	0	784	392	48	1;-6	-112	-392	0	784	980	784	168	8;-14	-112	0	392	392	784	980	336	28;-14	0	112	112	48	168	336	420	56;0	14	14	6	1	8	28	56	70];    %South
        D(:,:,8) = [0	-14	-14	-6	-1	-8	-28	-56	-70;14	0	-112	-112	-48	-168	-336	-420	-56;14	112	0	-392	-392	-784	-980	-336	-28;6	112	392	0	-784	-980	-784	-168	-8;1	48	392	784	0	-784	-392	-48	-1;8	168	784	980	784	0	-392	-112	-6;28	336	980	784	392	392	0	-112	-14;56	420	336	168	48	112	112	0	-14;70	56	28	8	1	6	14	14	0];   %South Eest
      case 11
        D(:,:,1) = [1	8	27	48	42	0	-42	-48	-27	-8	-1;10	80	270	480	420	0	-420	-480	-270	-80	-10;45	360	1215	2160	1890	0	-1890	-2160	-1215	-360	-45;120	960	3240	5760	5040	0	-5040	-5760	-3240	-960	-120;210	1680	5670	10080	8820	0	-8820	-10080	-5670	-1680	-210;252	2016	6804	12096	10584	0	-10584	-12096	-6804	-2016	-252;210	1680	5670	10080	8820	0	-8820	-10080	-5670	-1680	-210;120	960	3240	5760	5040	0	-5040	-5760	-3240	-960	-120;45	360	1215	2160	1890	0	-1890	-2160	-1215	-360	-45;10	80	270	480	420	0	-420	-480	-270	-80	-10;1	8	27	48	42	0	-42	-48	-27	-8	-1];    %East
        D(:,:,2) = [-1	-10	-45	-120	-210	-252	-210	-120	-45	-10	-1;-8	-80	-360	-960	-1680	-2016	-1680	-960	-360	-80	-8;-27	-270	-1215	-3240	-5670	-6804	-5670	-3240	-1215	-270	-27;-48	-480	-2160	-5760	-10080	-12096	-10080	-5760	-2160	-480	-48;-42	-420	-1890	-5040	-8820	-10584	-8820	-5040	-1890	-420	-42;0	0	0	0	0	0	0	0	0	0	0;42	420	1890	5040	8820	10584	8820	5040	1890	420	42;48	480	2160	5760	10080	12096	10080	5760	2160	480	48;27	270	1215	3240	5670	6804	5670	3240	1215	270	27;8	80	360	960	1680	2016	1680	960	360	80	8;1	10	45	120	210	252	210	120	45	10	1];     %North East
        D(:,:,3) = [-1	-8	-27	-48	-42	0	42	48	27	8	1;-10	-80	-270	-480	-420	0	420	480	270	80	10;-45	-360	-1215	-2160	-1890	0	1890	2160	1215	360	45;-120	-960	-3240	-5760	-5040	0	5040	5760	3240	960	120;-210	-1680	-5670	-10080	-8820	0	8820	10080	5670	1680	210;-252	-2016	-6804	-12096	-10584	0	10584	12096	6804	2016	252;-210	-1680	-5670	-10080	-8820	0	8820	10080	5670	1680	210;-120	-960	-3240	-5760	-5040	0	5040	5760	3240	960	120;-45	-360	-1215	-2160	-1890	0	1890	2160	1215	360	45;-10	-80	-270	-480	-420	0	420	480	270	80	10;-1	-8	-27	-48	-42	0	42	48	27	8	1];   %North
        D(:,:,4) = [1	10	45	120	210	252	210	120	45	10	1;8	80	360	960	1680	2016	1680	960	360	80	8;27	270	1215	3240	5670	6804	5670	3240	1215	270	27;48	480	2160	5760	10080	12096	10080	5760	2160	480	48;42	420	1890	5040	8820	10584	8820	5040	1890	420	42;0	0	0	0	0	0	0	0	0	0	0;-42	-420	-1890	-5040	-8820	-10584	-8820	-5040	-1890	-420	-42;-48	-480	-2160	-5760	-10080	-12096	-10080	-5760	-2160	-480	-48;-27	-270	-1215	-3240	-5670	-6804	-5670	-3240	-1215	-270	-27;-8	-80	-360	-960	-1680	-2016	-1680	-960	-360	-80	-8;-1	-10	-45	-120	-210	-252	-210	-120	-45	-10	-1];      %North West
        D(:,:,5) = [0	42	48	27	8	1	10	45	120	210	252;-42	0	420	480	270	80	360	960	1680	2016	210;-48	-420	0	1890	2160	1215	3240	5670	6804	1680	120;-27	-480	-1890	0	5040	5760	10080	12096	5670	960	45;-8	-270	-2160	-5040	0	8820	10584	10080	3240	360	10;-1	-80	-1215	-5760	-8820	0	8820	5760	1215	80	1;-10	-360	-3240	-10080	-10584	-8820	0	5040	2160	270	8;-45	-960	-5670	-12096	-10080	-5760	-5040	0	1890	480	27;-120	-1680	-6804	-5670	-3240	-1215	-2160	-1890	0	420	48;-210	-2016	-1680	-960	-360	-80	-270	-480	-420	0	42;-252	-210	-120	-45	-10	-1	-8	-27	-48	-42	0];         %West
        D(:,:,6) = [0	-42	-48	-27	-8	-1	-10	-45	-120	-210	-252;42	0	-420	-480	-270	-80	-360	-960	-1680	-2016	-210;48	420	0	-1890	-2160	-1215	-3240	-5670	-6804	-1680	-120;27	480	1890	0	-5040	-5760	-10080	-12096	-5670	-960	-45;8	270	2160	5040	0	-8820	-10584	-10080	-3240	-360	-10;1	80	1215	5760	8820	0	-8820	-5760	-1215	-80	-1;10	360	3240	10080	10584	8820	0	-5040	-2160	-270	-8;45	960	5670	12096	10080	5760	5040	0	-1890	-480	-27;120	1680	6804	5670	3240	1215	2160	1890	0	-420	-48;210	2016	1680	960	360	80	270	480	420	0	-42;252	210	120	45	10	1	8	27	48	42	0];         %South West
        D(:,:,7) = [252	210	120	45	10	1	8	27	48	42	0;210	2016	1680	960	360	80	270	480	420	0	-42;120	1680	6804	5670	3240	1215	2160	1890	0	-420	-48;45	960	5670	12096	10080	5760	5040	0	-1890	-480	-27;10	360	3240	10080	10584	8820	0	-5040	-2160	-270	-8;1	80	1215	5760	8820	0	-8820	-5760	-1215	-80	-1;8	270	2160	5040	0	-8820	-10584	-10080	-3240	-360	-10;27	480	1890	0	-5040	-5760	-10080	-12096	-5670	-960	-45;48	420	0	-1890	-2160	-1215	-3240	-5670	-6804	-1680	-120;42	0	-420	-480	-270	-80	-360	-960	-1680	-2016	-210;0	-42	-48	-27	-8	-1	-10	-45	-120	-210	-252];  %South
        D(:,:,8) = [-252	-210	-120	-45	-10	-1	-8	-27	-48	-42	0;-210	-2016	-1680	-960	-360	-80	-270	-480	-420	0	42;-120	-1680	-6804	-5670	-3240	-1215	-2160	-1890	0	420	48;-45	-960	-5670	-12096	-10080	-5760	-5040	0	1890	480	27;-10	-360	-3240	-10080	-10584	-8820	0	5040	2160	270	8;-1	-80	-1215	-5760	-8820	0	8820	5760	1215	80	1;-8	-270	-2160	-5040	0	8820	10584	10080	3240	360	10;-27	-480	-1890	0	5040	5760	10080	12096	5670	960	45;-48	-420	0	1890	2160	1215	3240	5670	6804	1680	120;-42	0	420	480	270	80	360	960	1680	2016	210;0	42	48	27	8	1	10	45	120	210	252]; %South Eest
      otherwise
        error('Soble mask size not supported. Use only: 3, 5, 7, 9, 11');
    end
  case 'prewitt'
    switch msize
      case 3
        D(:,:,1) = [1 1 1; 0 0 0; -1 -1 -1];      %East
        D(:,:,2) = [1 1 0; 1 0 -1; 0 -1 -1];      %North East
        D(:,:,3) = [1 0 -1; 1 0 -1; 1 0 -1];      %North
        D(:,:,4) = [0 -1 -1; 1 0 -1; 1 1 0];      %North West
        D(:,:,5) = [-1 -1 -1; 0 0 0; 1 1 1];      %West
        D(:,:,6) = [-1 -1 0; -1 0 1; 0 1 1];      %South West
        D(:,:,7) = [-1 0 1; -1 0 1; -1 0 1];      %South
        D(:,:,8) = [0 1 1; -1 0 1; -1 -1 0];      %South Eest
      case 5
        D(:,:,1) = [2	2	2	2	2;1	1	1	1	1;0	0	0	0	0;-1	-1	-1	-1	-1;-2	-2	-2	-2	-2];      %East
        D(:,:,2) = [2	1	0	-1	-2;2	1	0	-1	-2;2	1	0	-1	-2;2	1	0	-1	-2;2	1	0	-1	-2];    %North East
        D(:,:,3) = [-2	-1	0	1	2;-2	-1	0	1	2;-2	-1	0	1	2;-2	-1	0	1	2;-2	-1	0	1	2];   %North
        D(:,:,4) = [-2	-2	-2	-2	-2;-1	-1	-1	-1	-1;0	0	0	0	0;1	1	1	1	1;2	2	2	2	2];     %North West
        D(:,:,5) = [-2	-2	-2	-1	0;-2	-1	-1	0	1;-2	-1	0	1	2;-1	0	1	1	2;0	1	2	2	2];   %West
        D(:,:,6) = [0	1	2	2	2;-1	0	1	1	2;-2	-1	0	1	2;-2	-1	-1	0	1;-2	-2	-2	-1	0];   %South West
        D(:,:,7) = [0	-1	-2	-2	-2;1	0	-1	-1	-2;2	1	0	-1	-2;2	1	1	0	-1;2	2	2	1	0];   %South
        D(:,:,8) = [2	2	2	1	0;2	1	1	0	-1;2	1	0	-1	-2;1	0	-1	-1	-2;0	-1	-2	-2	-2];    %South Eest
      case 7
        D(:,:,1) = [3	3	3	3	3	3	3;2	2	2	2	2	2	2;1	1	1	1	1	1	1;0	0	0	0	0	0	0;-1	-1	-1	-1	-1	-1	-1;-2	-2	-2	-2	-2	-2	-2;-3	-3	-3	-3	-3	-3	-3];       %East
        D(:,:,2) = [3	2	1	0	-1	-2	-3;3	2	1	0	-1	-2	-3;3	2	1	0	-1	-2	-3;3	2	1	0	-1	-2	-3;3	2	1	0	-1	-2	-3;3	2	1	0	-1	-2	-3;3	2	1	0	-1	-2	-3];   %North East
        D(:,:,3) = [-3	-2	-1	0	1	2	3;-3	-2	-1	0	1	2	3;-3	-2	-1	0	1	2	3;-3	-2	-1	0	1	2	3;-3	-2	-1	0	1	2	3;-3	-2	-1	0	1	2	3;-3	-2	-1	0	1	2	3];  %North
        D(:,:,4) = [-3	-3	-3	-3	-3	-3	-3;-2	-2	-2	-2	-2	-2	-2;-1	-1	-1	-1	-1	-1	-1;0	0	0	0	0	0	0;1	1	1	1	1	1	1;2	2	2	2	2	2	2;3	3	3	3	3	3	3];      %North West
        D(:,:,5) = [-3	-3	-3	-3	-2	-1	0;-3	-2	-2	-2	-1	0	1;-3	-2	-1	-1	0	1	2;-3	-2	-1	0	1	2	3;-2	-1	0	1	1	2	3;-1	0	1	2	2	2	3;0	1	2	3	3	3	3];  %West
        D(:,:,6) = [0	1	2	3	3	3	3;-1	0	1	2	2	2	3;-2	-1	0	1	1	2	3;-3	-2	-1	0	1	2	3;-3	-2	-1	-1	0	1	2;-3	-2	-2	-2	-1	0	1;-3	-3	-3	-3	-2	-1	0];  %South West
        D(:,:,7) = [0	-1	-2	-3	-3	-3	-3;1	0	-1	-2	-2	-2	-3;2	1	0	-1	-1	-2	-3;3	2	1	0	-1	-2	-3;3	2	1	1	0	-1	-2;3	2	2	2	1	0	-1;3	3	3	3	2	1	0];  %South
        D(:,:,8) = [3	3	3	3	2	1	0;3	2	2	2	1	0	-1;3	2	1	1	0	-1	-2;3	2	1	0	-1	-2	-3;2	1	0	-1	-1	-2	-3;1	0	-1	-2	-2	-2	-3;0	-1	-2	-3	-3	-3	-3];   %South Eest
      case 9
        D(:,:,1) = [4	4	4	4	4	4	4	4	4;3	3	3	3	3	3	3	3	3;2	2	2	2	2	2	2	2	2;1	1	1	1	1	1	1	1	1;0	0	0	0	0	0	0	0	0;-1	-1	-1	-1	-1	-1	-1	-1	-1;-2	-2	-2	-2	-2	-2	-2	-2	-2;-3	-3	-3	-3	-3	-3	-3	-3	-3;-4	-4	-4	-4	-4	-4	-4	-4	-4];          %East
        D(:,:,2) = [4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4];    %North East
        D(:,:,3) = [-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4];   %North
        D(:,:,4) = [-4	-4	-4	-4	-4	-4	-4	-4	-4;-3	-3	-3	-3	-3	-3	-3	-3	-3;-2	-2	-2	-2	-2	-2	-2	-2	-2;-1	-1	-1	-1	-1	-1	-1	-1	-1;0	0	0	0	0	0	0	0	0;1	1	1	1	1	1	1	1	1;2	2	2	2	2	2	2	2	2;3	3	3	3	3	3	3	3	3;4	4	4	4	4	4	4	4	4];         %North West
        D(:,:,5) = [-4	-4	-4	-4	-4	-3	-2	-1	0;-4	-3	-3	-3	-3	-2	-1	0	1;-4	-3	-2	-2	-2	-1	0	1	2;-4	-3	-2	-1	-1	0	1	2	3;-4	-3	-2	-1	0	1	2	3	4;-3	-2	-1	0	1	1	2	3	4;-2	-1	0	1	2	2	2	3	4;-1	0	1	2	3	3	3	3	4;0	1	2	3	4	4	4	4	4];   %West
        D(:,:,6) = [0	1	2	3	4	4	4	4	4;-1	0	1	2	3	3	3	3	4;-2	-1	0	1	2	2	2	3	4;-3	-2	-1	0	1	1	2	3	4;-4	-3	-2	-1	0	1	2	3	4;-4	-3	-2	-1	-1	0	1	2	3;-4	-3	-2	-2	-2	-1	0	1	2;-4	-3	-3	-3	-3	-2	-1	0	1;-4	-4	-4	-4	-4	-3	-2	-1	0;];  %South West
        D(:,:,7) = [0	-1	-2	-3	-4	-4	-4	-4	-4;1	0	-1	-2	-3	-3	-3	-3	-4;2	1	0	-1	-2	-2	-2	-3	-4;3	2	1	0	-1	-1	-2	-3	-4;4	3	2	1	0	-1	-2	-3	-4;4	3	2	1	1	0	-1	-2	-3;4	3	2	2	2	1	0	-1	-2;4	3	3	3	3	2	1	0	-1;4	4	4	4	4	3	2	1	0];   %South
        D(:,:,8) = [4	4	4	4	4	3	2	1	0;4	3	3	3	3	2	1	0	-1;4	3	2	2	2	1	0	-1	-2;4	3	2	1	1	0	-1	-2	-3;4	3	2	1	0	-1	-2	-3	-4;3	2	1	0	-1	-1	-2	-3	-4;2	1	0	-1	-2	-2	-2	-3	-4;1	0	-1	-2	-3	-3	-3	-3	-4;0	-1	-2	-3	-4	-4	-4	-4	-4];    %South Eest
      case 11
        D(:,:,1) = [5	5	5	5	5	5	5	5	5	5	5;4	4	4	4	4	4	4	4	4	4	4;3	3	3	3	3	3	3	3	3	3	3;2	2	2	2	2	2	2	2	2	2	2;1	1	1	1	1	1	1	1	1	1	1;0	0	0	0	0	0	0	0	0	0	0;-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1;-2	-2	-2	-2	-2	-2	-2	-2	-2	-2	-2;-3	-3	-3	-3	-3	-3	-3	-3	-3	-3	-3;-4	-4	-4	-4	-4	-4	-4	-4	-4	-4	-4;-5	-5	-5	-5	-5	-5	-5	-5	-5	-5	-5];           %East
        D(:,:,2) = [5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5];   %North East
        D(:,:,3) = [-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5];  %North
        D(:,:,4) = [-5	-5	-5	-5	-5	-5	-5	-5	-5	-5	-5;-4	-4	-4	-4	-4	-4	-4	-4	-4	-4	-4;-3	-3	-3	-3	-3	-3	-3	-3	-3	-3	-3;-2	-2	-2	-2	-2	-2	-2	-2	-2	-2	-2;-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1;0	0	0	0	0	0	0	0	0	0	0;1	1	1	1	1	1	1	1	1	1	1;2	2	2	2	2	2	2	2	2	2	2;3	3	3	3	3	3	3	3	3	3	3;4	4	4	4	4	4	4	4	4	4	4;5	5	5	5	5	5	5	5	5	5	5];          %North West
        D(:,:,5) = [0	-1	-2	-3	-4	-5	-5	-5	-5	-5	-5;1	0	-1	-2	-3	-4	-4	-4	-4	-4	-5;2	1	0	-1	-2	-3	-3	-3	-3	-4	-5;3	2	1	0	-1	-2	-2	-2	-3	-4	-5;4	3	2	1	0	-1	-1	-2	-3	-4	-5;5	4	3	2	1	0	-1	-2	-3	-4	-5;5	4	3	2	1	1	0	-1	-2	-3	-4;5	4	3	2	2	2	1	0	-1	-2	-3;5	4	3	3	3	3	2	1	0	-1	-2;5	4	4	4	4	4	3	2	1	0	-1;5	5	5	5	5	5	4	3	2	1	0];  %West
        D(:,:,6) = [0	1	2	3	4	5	5	5	5	5	5;-1	0	1	2	3	4	4	4	4	4	5;-2	-1	0	1	2	3	3	3	3	4	5;-3	-2	-1	0	1	2	2	2	3	4	5;-4	-3	-2	-1	0	1	1	2	3	4	5;-5	-4	-3	-2	-1	0	1	2	3	4	5;-5	-4	-3	-2	-1	-1	0	1	2	3	4;-5	-4	-3	-2	-2	-2	-1	0	1	2	3;-5	-4	-3	-3	-3	-3	-2	-1	0	1	2;-5	-4	-4	-4	-4	-4	-3	-2	-1	0	1;-5	-5	-5	-5	-5	-5	-4	-3	-2	-1	0];  %South West
        D(:,:,7) = [-5	-5	-5	-5	-5	-5	-4	-3	-2	-1	0;-5	-4	-4	-4	-4	-4	-3	-2	-1	0	1;-5	-4	-3	-3	-3	-3	-2	-1	0	1	2;-5	-4	-3	-2	-2	-2	-1	0	1	2	3;-5	-4	-3	-2	-1	-1	0	1	2	3	4;-5	-4	-3	-2	-1	0	1	2	3	4	5;-4	-3	-2	-1	0	1	1	2	3	4	5;-3	-2	-1	0	1	2	2	2	3	4	5;-2	-1	0	1	2	3	3	3	3	4	5;-1	0	1	2	3	4	4	4	4	4	5;0	1	2	3	4	5	5	5	5	5	5];  %South
        D(:,:,8) = [5	5	5	5	5	5	4	3	2	1	0;5	4	4	4	4	4	3	2	1	0	-1;5	4	3	3	3	3	2	1	0	-1	-2;5	4	3	2	2	2	1	0	-1	-2	-3;5	4	3	2	1	1	0	-1	-2	-3	-4;5	4	3	2	1	0	-1	-2	-3	-4	-5;4	3	2	1	0	-1	-1	-2	-3	-4	-5;3	2	1	0	-1	-2	-2	-2	-3	-4	-5;2	1	0	-1	-2	-3	-3	-3	-3	-4	-5;1	0	-1	-2	-3	-4	-4	-4	-4	-4	-5;0	-1	-2	-3	-4	-5	-5	-5	-5	-5	-5];   %South Eest
      otherwise
        error('Prewitt mask size not supported. Use only: 3, 5, 7, 9, 11');
    end
  otherwise
    error('Mask not supported. Use only: Kirsch, Sobel, Prewitt');
end
%% LDN Code computation
[r, c] = size(I);
% create space
% we use 8 directions, if you use more then change this magic number
R = zeros(r, c, 8);

% Compute responses
for i=1:8
  R(:,:,i) = imfilter(I,D(:,:,i));
end

% sort responses, from most negative to most possitive
[~, idx] = sort(R,3,'descend');

% return only the indexes, equivalent to orientation direction
% encoding [edge gradient]
top = idx(:,:,[1 end])-1;
C = top(:,:,1).*8 + top(:,:,2);
end

%% Gaussian mask
% Compute the mask
function [D] = gaussGradient(sigma)
epsilon=1e-2;
halfsize=ceil(sigma*sqrt(-2*log(sqrt(2*pi)*sigma*epsilon)));
size=2*halfsize+1;
% generate a 2-D Gaussian kernel along x direction
hx = zeros(size);
for i=1:size
    for j=1:size
        u=[i-halfsize-1 j-halfsize-1];
        % change the shift of the gaussian
        hx(i,j)=gauss(u(1)-halfsize+1,sigma)*dgauss(u(2),sigma);
    end
end

hx=hx/sqrt(sum(sum(abs(hx).*abs(hx))));

% generate a 2-D Gaussian kernel along y direction
D(:,:,1) = hx;
D(:,:,2) = imrotate(hx,45,'crop');
D(:,:,3) = imrotate(hx,90,'crop');
D(:,:,4) = imrotate(hx,135,'crop');
D(:,:,5) = imrotate(hx,180,'crop');
D(:,:,6) = imrotate(hx,225,'crop');
D(:,:,7) = imrotate(hx,270,'crop');
D(:,:,8) = imrotate(hx,315,'crop');
end

%Gaussian function
function y = gauss(x,sigma)
y = exp(-x^2/(2*sigma^2)) / (sigma*sqrt(2*pi));
end

%first order derivative of Gaussian
function y = dgauss(x,sigma)
y = -x * gauss(x,sigma) / sigma^2;
end